<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书 Agent - Prompt设计思路</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f8fafc;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 100%;
            background: white;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        h1 {
            font-size: 2em;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .mermaid-container {
            background: white;
            width: 100%;
            aspect-ratio: 16 / 9;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px 40px 20px 20px;
            border: none;
            overflow: visible;
        }

        #diagram1 {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #diagram2 {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-right: 40px;
        }

        .mermaid {
            text-align: center;
            font-size: 14px;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .mermaid svg {
            max-width: calc(100% - 20px) !important;
            max-height: 100% !important;
            width: auto !important;
            height: auto !important;
        }

        .mermaid > svg {
            display: block;
            margin: 0 auto;
        }

        #diagram1 .mermaid {
            font-size: 10px;
        }

        #diagram2 .mermaid {
            font-size: 9px;
        }

        #diagram2 .mermaid svg {
            padding-right: 30px !important;
        }

        /* 让所有线框圆角化 */
        .mermaid svg rect {
            rx: 8px !important;
            ry: 8px !important;
        }

        .mermaid svg .cluster rect {
            rx: 12px !important;
            ry: 12px !important;
        }

        /* 确保箭头和连接线不被裁剪 */
        .mermaid svg g.edgePath {
            overflow: visible !important;
        }

        .mermaid svg marker {
            overflow: visible !important;
        }

        .mermaid svg g.edgePath path {
            overflow: visible !important;
        }

        .mermaid svg defs {
            overflow: visible !important;
        }

        /* 确保SVG右侧有足够空间 */
        .mermaid svg {
            margin-right: 20px !important;
        }

        /* 增加subgraph标题与边框的间距 */
        .mermaid svg .cluster-label {
            padding: 15px 20px 40px 20px !important;
            margin-bottom: 20px !important;
        }

        .mermaid svg .cluster text {
            margin: 12px 0 40px 0 !important;
        }

        .mermaid svg .cluster {
            padding: 30px 20px 20px 20px !important;
        }

        /* 节点标签下方增加间距 */
        .mermaid svg .nodeLabel {
            margin-bottom: 15px !important;
            padding-bottom: 15px !important;
        }

        .save-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: white;
            color: #1e293b;
            border: 2px solid #1e293b;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .save-btn:hover {
            background: #1e293b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .save-btn:active {
            transform: translateY(0);
        }

        .save-btn:disabled {
            background: #f1f5f9;
            color: #94a3b8;
            border-color: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mermaid-container" id="diagram1">
            <button class="save-btn" onclick="saveImage(1)">保存为图片</button>
            <div class="mermaid">
graph LR
    %% 上半部分：用户场景到方案灵感
    Start>"创作者（我）在小红书<br/>评论区互动"]

    Start --> Scenarios

    subgraph Scenarios["用户场景与痛点"]
        direction TB

        SC1("需要及时回复评论")

        P1("语言组织难题<br/>● 咬文嚼字 2-5分钟/条<br/>● 社交压力大<br/>● 不知道说什么")

        P2("回复效率问题<br/>● 重复问题反复回答<br/>● 回复慢影响信任<br/>● 知识盲区无法应对")

        P3("工具使用困境<br/>● 手动问ChatGPT 重复麻烦<br/>● 工具来回切换<br/>● 平台跳转繁琐<br/>● 效率低下")

        SC1 --> P1
        SC1 --> P2
        SC1 --> P3
    end

    Scenarios --> Solutions

    subgraph Solutions["方案灵感"]
        direction TB
        Sol1("省时<br/>AI自动生成回复<br/>10-20秒完成")
        Sol2("省力<br/>智能理解上下文<br/>自动适配场景")
        Sol3("省步骤<br/>浏览器插件原生集成<br/>一键触发无需跳转")
        Sol1 ~~~ Sol2 ~~~ Sol3
    end

    %% 上半部分样式定义
    classDef startStyle fill:#ffffff,stroke:#000000,stroke-width:2px,color:#000000
    classDef scenarioStyle fill:#fef3c7,stroke:#f59e0b,stroke-width:1.5px,color:#78350f
    classDef painStyle fill:#fee2e2,stroke:#dc2626,stroke-width:1.5px,color:#7f1d1d
    classDef solutionStyle fill:#dcfce7,stroke:#22c55e,stroke-width:1.5px,color:#166534

    class Start startStyle
    class SC1 scenarioStyle
    class P1,P2,P3 painStyle
    class Sol1,Sol2,Sol3 solutionStyle

    style Scenarios fill:#ffffff,stroke:#64748b,stroke-width:2px
    style Solutions fill:#ffffff,stroke:#64748b,stroke-width:2px
            </div>
        </div>

        <div class="mermaid-container" id="diagram2">
            <button class="save-btn" onclick="saveImage(2)">保存为图片</button>
            <div class="mermaid">
graph LR
    %% 下半部分：基于Prompt设计的完整解决方案

    Start2("开始设计")

    Start2 --> Q1

    subgraph Q1["① 推理过程需要什么？<br/>Context与规则"]
        direction TB

        C1("Context组成")

        C1_1("笔记内容<br/>● 标题、正文、图片")
        C1_2("评论上下文<br/>● 当前评论<br/>● 父级评论")
        C1_3("人设定义<br/>● 语气风格<br/>● 专业领域")

        C1 --> C1_1
        C1 --> C1_2
        C1 --> C1_3

        Rule("生成规则<br/>● 控制数量<br/>● 限制字数")

        C1_1 ~~~ C1_2 ~~~ C1_3 ~~~ Rule
    end

    Q1 --> Q2

    subgraph Q2["② 用什么模型？<br/>三模型协作流程"]
        direction TB

        subgraph Vision["视觉理解模型"]
            VM("Qwen-VL")
            VM1("● 图片内容识别")
            VM2("● 文字OCR提取")
            VM3("● 图文语义理解")
            VM --> VM1
            VM --> VM2
            VM --> VM3
        end

        subgraph Struct["生成结构化模型"]
            SM("Qwen-Turbo")
            SM1("● 意图分析")
            SM2("● 关键信息提取")
            SM3("● 上下文整合")
            SM --> SM1
            SM --> SM2
            SM --> SM3
        end

        subgraph Content["生成文案模型"]
            CM("DeepSeek-Chat")
            CM1("● 自然语言生成")
            CM2("● 人设语气适配")
            CM3("● 多条回复候选")
            CM --> CM1
            CM --> CM2
            CM --> CM3
        end

        Vision --> Struct
        Struct --> Content
    end

    Q2 --> Q3

    subgraph Q3["③ 功能怎么交互？<br/>UI视觉设计"]
        direction TB

        UI1("原生样式<br/>● 无缝融入小红书界面")
        UI2("布局位置<br/>● 评论区下方显示")
        UI3("触发方式<br/>● 点击AI图标<br/>● 一键生成")
        UI4("编辑功能<br/>● 支持修改<br/>● 确认发送")

        UI1 --> UI2 --> UI3 --> UI4
    end

    Q3 --> Q4

    subgraph Q4["④ 怎么控成本？<br/>数据缓存机制"]
        direction TB

        Cache1("缓存策略")

        C_1("保留上次生成<br/>● Memory存储")
        C_2("重新生成替换<br/>● 更新为最新内容")
        C_3("避免重复调用<br/>● 相同内容识别并复用<br/>● 无需重复调用API")

        Cache1 --> C_1
        Cache1 --> C_2
        Cache1 --> C_3
    end

    Q4 --> Result

    subgraph Result["实现结果"]
        direction TB

        R1("开发时间<br/>45分钟 Claude Code")
        R2("用户体验<br/>10-20秒生成回复")
        R3("准确率<br/>85%+ 满意度")

        R1 ~~~ R2 ~~~ R3
    end

    %% 下半部分样式定义
    classDef startStyle2 fill:#ffffff,stroke:#000000,stroke-width:2px,color:#000000
    classDef contextStyle fill:#fef3c7,stroke:#f59e0b,stroke-width:1.5px,color:#78350f
    classDef visionStyle fill:#fce7f3,stroke:#ec4899,stroke-width:1.5px,color:#831843
    classDef structStyle fill:#e0e7ff,stroke:#6366f1,stroke-width:1.5px,color:#3730a3
    classDef contentStyle fill:#e9d5ff,stroke:#a855f7,stroke-width:1.5px,color:#6b21a8
    classDef uiStyle fill:#dbeafe,stroke:#2563eb,stroke-width:1.5px,color:#1e3a8a
    classDef cacheStyle fill:#d1fae5,stroke:#10b981,stroke-width:1.5px,color:#065f46
    classDef resultStyle fill:#fee2e2,stroke:#dc2626,stroke-width:1.5px,color:#7f1d1d

    class Start2 startStyle2
    class C1,C1_1,C1_2,C1_3,Rule contextStyle
    class VM,VM1,VM2,VM3 visionStyle
    class SM,SM1,SM2,SM3 structStyle
    class CM,CM1,CM2,CM3 contentStyle
    class UI1,UI2,UI3,UI4 uiStyle
    class Cache1,C_1,C_2,C_3 cacheStyle
    class R1,R2,R3 resultStyle

    style Q1 fill:#ffffff,stroke:#404040,stroke-width:2px
    style Q2 fill:#ffffff,stroke:#525252,stroke-width:2px
    style Vision fill:#ffffff,stroke:#606060,stroke-width:1.5px
    style Struct fill:#ffffff,stroke:#555555,stroke-width:1.5px
    style Content fill:#ffffff,stroke:#4a4a4a,stroke-width:1.5px
    style Q3 fill:#ffffff,stroke:#4d4d4d,stroke-width:2px
    style Q4 fill:#ffffff,stroke:#484848,stroke-width:2px
    style Result fill:#ffffff,stroke:#505050,stroke-width:2px
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 20,
                nodeSpacing: 30,
                rankSpacing: 50,
                diagramPadding: 30,
                subGraphTitleMargin: {
                    top: 10,
                    bottom: 40
                }
            }
        });

        async function saveImage(diagramNumber) {
            const container = document.getElementById(`diagram${diagramNumber}`);
            const btn = container.querySelector('.save-btn');
            const originalText = btn.textContent;

            // 禁用按钮并显示加载状态
            btn.disabled = true;
            btn.textContent = '⏳ 生成中...';

            try {
                // 等待一小段时间确保mermaid渲染完成
                await new Promise(resolve => setTimeout(resolve, 500));

                // 隐藏按钮以便截图时不显示
                btn.style.display = 'none';

                // 使用html2canvas捕获容器
                const canvas = await html2canvas(container, {
                    backgroundColor: '#ffffff',
                    scale: 2, // 2倍分辨率，提高图片质量
                    logging: false,
                    windowWidth: container.scrollWidth,
                    windowHeight: container.scrollHeight
                });

                // 显示按钮
                btn.style.display = 'block';

                // 转换为blob并下载
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const partName = diagramNumber === 1 ? '用户场景与方案灵感' : 'Prompt设计流程';
                    link.download = `小红书Agent-${partName}-${timestamp}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);

                    // 恢复按钮状态
                    btn.disabled = false;
                    btn.textContent = originalText;
                }, 'image/png');

            } catch (error) {
                console.error('保存图片失败:', error);
                alert('保存图片失败，请重试或使用手动截图');
                btn.style.display = 'block'; // 确保出错时也显示按钮
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }
    </script>
</body>
</html>