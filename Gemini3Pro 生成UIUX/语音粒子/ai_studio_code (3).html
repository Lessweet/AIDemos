<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Voice Interface - Clean</title>
    <style>
        :root {
            --gold-color: #b48c50;
            --bg-color: #ffffff;
            --text-color: #333333;
            --btn-bg: #f2f2f2;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #F2F2F7;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overscroll-behavior: none;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background-color: var(--bg-color);
            border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .status-bar {
            height: 44px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            font-size: 15px;
            font-weight: 600;
            z-index: 10;
            user-select: none;
        }

        .dynamic-island {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 35px;
            background-color: black;
            border-radius: 20px;
            z-index: 11;
        }

        .status-icons { display: flex; gap: 6px; }


        .canvas-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-end; 
            position: relative;
            padding-bottom: 30px;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            touch-action: none;
            z-index: 1;
        }

        .transcript-container {
            position: relative;
            z-index: 5;
            width: 84%;
            min-height: 80px;
            text-align: center;
            margin-bottom: 30px;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .transcript-text {
            font-size: 20px;
            font-weight: 500;
            color: #111;
            line-height: 1.5;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            text-shadow: 0 2px 10px rgba(255,255,255,0.8);
        }

        .transcript-text.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 隐藏了之前的 state-indicator (SIRI标签) */
        .state-indicator {
            display: none; 
        }

        .bottom-bar {
            height: 120px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px 20px 40px;
            box-sizing: border-box;
            user-select: none;
            z-index: 10;
        }

        .btn-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--btn-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .btn-circle:active {
            background-color: #d0d0d0;
            transform: scale(0.95);
        }

        /* 手机端：缩放手机模型以适应小屏幕 */
        @media (max-width: 420px) {
            .phone-container {
                transform: scale(0.85);
                transform-origin: center center;
            }
        }
    </style>
</head>
<body>

    <div class="phone-container">
        <div class="dynamic-island"></div>

        <div class="status-bar">
            <span id="clock">23:11</span>
            <div class="status-icons">
                <svg width="18" height="12" viewBox="0 0 18 12" fill="black"><path d="M1 10h3v-2H1v2zm5 0h3V5H6v5zm5 0h3V2h-3v8zm5 0h3V0h-3v10z"/></svg>
                <svg width="18" height="12" viewBox="0 0 18 12" fill="black"><path d="M9 11l-8-9h16l-8 9z"/></svg>
                <svg width="22" height="12" viewBox="0 0 25 12" fill="none"><rect x="0.5" y="0.5" width="20" height="10" rx="2.5" stroke="black"/><rect x="2" y="2" width="17" height="7" rx="1.5" fill="black"/><path d="M23 4v4" stroke="black" stroke-linecap="round"/></svg>
            </div>
        </div>


        <div class="canvas-wrapper" id="canvas-container">
            <canvas id="particleCanvas"></canvas>
            
            <div class="transcript-container">
                <!-- 删除了 SIRI 标签 -->
                <div class="transcript-text" id="transcript"></div>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="btn-circle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </div>
            
            <div class="btn-circle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
            </div>
        </div>
    </div>

    <script>
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock').innerText = `${hours}:${minutes}`;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // --- 模拟对话逻辑 ---
        const systemState = {
            speaker: 'idle', 
            audioLevel: 0,
            smoothedLevel: 0 
        };

        const transcriptEl = document.getElementById('transcript');

        // 更新脚本：移除了 "我在听"
        const script = [
            { speaker: 'ai', text: "根据您的日程，下午三点有一个会议。", duration: 3500 },
            { speaker: 'user', text: "...", duration: 1500 },
            { speaker: 'ai', text: "已经为您设置好提前15分钟的提醒。", duration: 3000 },
            { speaker: 'idle', text: "", duration: 2000 }
        ];

        let scriptIndex = 0;

        function playScript() {
            const scene = script[scriptIndex];
            systemState.speaker = scene.speaker;

            if (scene.speaker === 'ai') {
                transcriptEl.innerText = ""; 
                typeWriter(scene.text, scene.duration);
            } else if (scene.speaker === 'user') {
                // 用户思考/说话状态，不显示文字或显示 "..."
                transcriptEl.classList.remove('active'); 
                setTimeout(nextScene, scene.duration);
            } else {
                transcriptEl.classList.remove('active');
                setTimeout(nextScene, scene.duration);
            }
        }

        function typeWriter(text, duration) {
            transcriptEl.classList.add('active');
            let charIndex = 0;
            const speed = duration / text.length;

            const interval = setInterval(() => {
                if (charIndex < text.length) {
                    transcriptEl.innerText += text.charAt(charIndex);
                    charIndex++;
                } else {
                    clearInterval(interval);
                    setTimeout(nextScene, 1000);
                }
            }, speed);
        }

        function nextScene() {
            scriptIndex = (scriptIndex + 1) % script.length;
            playScript();
        }

        function updateAudioSimulation() {
            if (systemState.speaker === 'ai') {
                const time = Date.now() / 80; 
                const wave = (Math.sin(time) + Math.cos(time * 1.5) + 2) / 4; 
                const jitter = Math.random() > 0.8 ? Math.random() * 0.5 : 0;
                systemState.audioLevel = wave + jitter;
            } else {
                systemState.audioLevel = 0;
            }
            systemState.smoothedLevel += (systemState.audioLevel - systemState.smoothedLevel) * 0.1;
            requestAnimationFrame(updateAudioSimulation);
        }

        updateAudioSimulation();
        // 延迟一秒后直接开始对话，不再等待
        setTimeout(playScript, 1000);


        // --- 粒子视觉引擎 (保持飞散效果) ---
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvas-container');
        
        let width, height;
        const particleCount = 850; 
        const baseRadius = 130; 
        let angleX = 0;
        let angleY = 0;

        const mouse = { x: -9999, y: -9999, active: false };
        const particles = [];

        function resize() {
            width = container.clientWidth;
            height = container.clientHeight;
            canvas.width = width * 2; 
            canvas.height = height * 2;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            ctx.scale(2, 2);
        }

        function updateMouse(x, y) {
            const rect = canvas.getBoundingClientRect();
            mouse.x = x - rect.left;
            mouse.y = y - rect.top;
            mouse.active = true;
        }

        container.addEventListener('mousemove', e => updateMouse(e.clientX, e.clientY));
        container.addEventListener('mouseleave', () => { mouse.active = false; });
        container.addEventListener('touchmove', e => { e.preventDefault(); updateMouse(e.touches[0].clientX, e.touches[0].clientY); }, { passive: false });
        container.addEventListener('touchstart', e => updateMouse(e.touches[0].clientX, e.touches[0].clientY), { passive: false });
        container.addEventListener('touchend', () => { mouse.active = false; });

        function initParticles() {
            const phi = Math.PI * (3 - Math.sqrt(5)); 
            for (let i = 0; i < particleCount; i++) {
                const y = 1 - (i / (particleCount - 1)) * 2; 
                const r = Math.sqrt(1 - y * y); 
                const theta = phi * i; 
                
                const x = Math.cos(theta) * r;
                const z = Math.sin(theta) * r;

                particles.push({
                    baseX: x * baseRadius,
                    baseY: y * baseRadius,
                    baseZ: z * baseRadius,
                    dx: 0, dy: 0, dz: 0,
                    vx: 0, vy: 0, vz: 0,
                    friction: 0.94 + Math.random() * 0.02,
                    returnSpeed: 0.015 + Math.random() * 0.01
                });
            }
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);

            const feedback = systemState.smoothedLevel;

            angleX += 0.0015;
            angleY += 0.0025;

            const cx = width / 2;
            const cy = height / 2 - 40; 
            const fov = 400; 

            particles.forEach(p => {
                let xRot = p.baseX * Math.cos(angleY) - p.baseZ * Math.sin(angleY);
                let z1 = p.baseZ * Math.cos(angleY) + p.baseX * Math.sin(angleY);
                let yRot = p.baseY * Math.cos(angleX) - z1 * Math.sin(angleX);
                let zRot = z1 * Math.cos(angleX) + p.baseY * Math.sin(angleX);

                if (feedback > 0.05) {
                    const scatterStrength = feedback * 2.5; 
                    p.vx += (Math.random() - 0.5) * scatterStrength;
                    p.vy += (Math.random() - 0.5) * scatterStrength;
                    p.vz += (Math.random() - 0.5) * scatterStrength;
                    p.vx += (p.baseX / baseRadius) * feedback * 0.5;
                    p.vy += (p.baseY / baseRadius) * feedback * 0.5;
                }

                const tempScale = fov / (fov + zRot);
                const screenX = (xRot + p.dx) * tempScale + cx;
                const screenY = (yRot + p.dy) * tempScale + cy;

                if (mouse.active) {
                    const dx = screenX - mouse.x;
                    const dy = screenY - mouse.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    const interactRadius = 140;

                    if (dist < interactRadius) {
                        const force = (interactRadius - dist) / interactRadius;
                        const angle = Math.atan2(dy, dx);
                        const push = 3.5;
                        p.vx += Math.cos(angle) * force * push;
                        p.vy += Math.sin(angle) * force * push;
                        p.vz += (Math.random() - 0.5) * force * push * 2;
                    }
                }

                p.vx *= p.friction;
                p.vy *= p.friction;
                p.vz *= p.friction;

                const currentReturnSpeed = p.returnSpeed * (1 - feedback * 0.6); 

                p.vx -= p.dx * currentReturnSpeed;
                p.vy -= p.dy * currentReturnSpeed;
                p.vz -= p.dz * currentReturnSpeed;

                p.dx += p.vx;
                p.dy += p.vy;
                p.dz += p.vz;

                const finalX = xRot + p.dx;
                const finalY = yRot + p.dy;
                const finalZ = zRot + p.dz;

                const scale = fov / (fov + finalZ);
                const x2d = finalX * scale + cx;
                const y2d = finalY * scale + cy;

                let alpha = (scale - 0.4) * 1.5;
                const disp = Math.sqrt(p.dx**2 + p.dy**2 + p.dz**2);
                if(disp > 30) {
                    alpha *= Math.max(0.4, 1 - disp / 400); 
                }
                alpha += feedback * 0.2;

                const size = scale * 1.3;

                if (alpha > 0) {
                    ctx.fillStyle = `rgba(197, 160, 101, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(x2d, y2d, size, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);
        resize();
        initParticles();
        animate();

    </script>
</body>
</html>